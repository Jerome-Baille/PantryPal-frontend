<div class="search-container">
  <form [formGroup]="searchForm" class="search-bar">
    <input
      #searchInput
      type="text"
      id="search-input"
      name="search"
      [placeholder]="'SEARCH_PLACEHOLDER' | translate"
      aria-label="Search a recipe."
      formControlName="search"
      (keydown)="onKeyDown($event)"
      (focus)="onInputFocus()"
      autocomplete="off">
      <button type="button" (click)="submitSearch()">
        <mat-icon svgIcon="search"></mat-icon>
      </button>
    </form>

    <!-- Search Dropdown -->
    @if (showDropdown) {
      <div class="search-dropdown" [@slideInOut]>
        <!-- Loading state -->
        @if (isLoading) {
          <div class="dropdown-loading">
            <mat-spinner diameter="20"></mat-spinner>
            <span>{{ 'SEARCHING' | translate }}...</span>
          </div>
        }
        <!-- Search results -->
        @if (!isLoading && dropdownResults.length > 0) {
          <div class="dropdown-results">
            @for (recipe of dropdownResults; track recipe.id; let i = $index) {
              <div
                class="dropdown-item"
                [class.selected]="i === selectedIndex"
                (click)="selectRecipe(recipe)"
                (keydown.enter)="selectRecipe(recipe)"
                (mouseenter)="selectedIndex = i"
                tabindex="0"
                role="option"
                [attr.aria-selected]="i === selectedIndex">
                <div class="recipe-info">
                  <div class="recipe-title">{{ recipe.title }}</div>
                  <div class="recipe-meta">
                    @if (recipe.preparationTime) {
                      <span>
                        <mat-icon>schedule</mat-icon>
                        {{ recipe.preparationTime }} {{ recipe.preparationUnit }}
                      </span>
                    }
                    @if (recipe.servings) {
                      <span>
                        <mat-icon>people</mat-icon>
                        {{ recipe.servings }} {{ 'SERVINGS' | translate }}
                      </span>
                    }
                  </div>
                </div>
                <mat-icon class="arrow-icon">chevron_right</mat-icon>
              </div>
            }
            <!-- View all results -->
            <div class="dropdown-item view-all" 
                 (click)="viewAllResults()"
                 (keydown.enter)="viewAllResults()"
                 tabindex="0"
                 role="button"
                 aria-label="View all search results">
              <div class="view-all-text">
                <mat-icon>search</mat-icon>
                {{ 'VIEW_ALL_RESULTS' | translate }}
              </div>
            </div>
          </div>
        }
        <!-- No results -->
        @if (showNoResults) {
          <div class="dropdown-no-results">
            <mat-icon>search_off</mat-icon>
            <span>{{ 'NO_RECIPES_FOUND' | translate }}</span>
          </div>
        }
      </div>
    }
  </div>
