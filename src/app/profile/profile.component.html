<div class="profile-container">
    <!-- First row: Language Settings and Logout Section side by side -->
    <div class="bento-row">
        <!-- Language Settings Card -->
        <mat-card class="language-settings bento-item">
            <mat-card-header>
                <mat-icon mat-card-avatar>language</mat-icon>
                <mat-card-title>
                    {{ 'LANGUAGE' | translate }}
                </mat-card-title>
            </mat-card-header>
            <mat-card-content>
                <mat-button-toggle-group [value]="currentLang" (change)="switchLanguage($event.value)">
                    <mat-button-toggle value="en">English</mat-button-toggle>
                    <mat-button-toggle value="fr">Fran√ßais</mat-button-toggle>
                </mat-button-toggle-group>
            </mat-card-content>
        </mat-card>

        <!-- Logout Section -->
        <mat-card class="logout-section bento-item">
            <mat-card-header>
                <mat-icon mat-card-avatar>exit_to_app</mat-icon>
                <mat-card-title>{{ 'ACCOUNT' | translate }}</mat-card-title>
            </mat-card-header>
            <mat-card-content>
                <button mat-raised-button color="warn" (click)="onLogout()">
                    <mat-icon>logout</mat-icon>
                    {{ 'LOGOUT' | translate }}
                </button>
            </mat-card-content>
        </mat-card>
    </div>

    <!-- Second row: Share Settings and Share Links side by side -->
    <div class="bento-row">
        <!-- Share Settings Card -->
        <mat-card class="share-settings bento-item">
            <mat-card-header>
                <mat-icon mat-card-avatar>settings</mat-icon>
                <mat-card-title>{{ 'SHARE_SETTINGS' | translate }}</mat-card-title>
            </mat-card-header>
            <mat-card-content>
                <form [formGroup]="shareForm" (ngSubmit)="createShareLink()">
                    <mat-form-field class="full-width" appearance="outline">
                        <mat-label>{{ 'PERMISSION_LEVEL' | translate }}</mat-label>
                        <mat-select formControlName="permissionLevel">
                            <mat-option value="read">{{ 'READ_ONLY' | translate }}</mat-option>
                            <mat-option value="edit">{{ 'READ_WRITE' | translate }}</mat-option>
                        </mat-select>
                    </mat-form-field>

                    <mat-form-field class="full-width" appearance="outline">
                        <mat-label>{{ 'EXPIRES_IN_DAYS' | translate }}</mat-label>
                        <input matInput type="number" formControlName="expiresInDays" min="1" max="30">
                    </mat-form-field>

                    <button mat-raised-button color="primary" type="submit">
                        <mat-icon>link</mat-icon>
                        {{ 'CREATE_SHARE_LINK' | translate }}
                    </button>
                </form>

                <div *ngIf="shareUrl" class="share-url-container">
                    <mat-form-field class="full-width" appearance="outline">
                        <mat-label>{{ 'SHARE_URL' | translate }}</mat-label>
                        <input matInput [value]="shareUrl" readonly>
                        <button matSuffix mat-icon-button (click)="copyShareUrl()" matTooltip="{{ 'COPY_TO_CLIPBOARD' | translate }}">
                            <mat-icon>content_copy</mat-icon>
                        </button>
                    </mat-form-field>
                </div>
            </mat-card-content>
        </mat-card>

        <!-- Share Links Section -->
        <mat-card class="share-links-section bento-item">
            <mat-card-header>
                <mat-icon mat-card-avatar>link</mat-icon>
                <mat-card-title>{{ 'SHARE_LINKS' | translate }}</mat-card-title>
            </mat-card-header>
            <mat-card-content>
                <div class="toggle-container">
                    <mat-slide-toggle [(ngModel)]="showAllLinks" (change)="loadShareLinks()">
                        {{ 'SHOW_ALL_LINKS' | translate }}
                    </mat-slide-toggle>
                </div>
                
                <div class="share-links-list">
                    <div *ngIf="shareLinks.length === 0" class="no-links-message">
                        {{ 'NO_SHARE_LINKS' | translate }}
                    </div>
                    
                    <mat-card *ngFor="let link of shareLinks" class="share-link-item">
                        <div class="link-header">
                            <div class="link-title">
                                <span *ngIf="link.type === 'recipe'" class="recipe-title">{{ link.recipe?.title }}</span>
                                <span *ngIf="link.type === 'global'" class="all-recipes">{{ 'ALL_RECIPES' | translate }}</span>
                            </div>
                            <div class="link-status">
                                <span [class]="'status-badge ' + link.status">{{ link.status | uppercase }}</span>
                            </div>
                        </div>
                        
                        <div class="link-content">
                            <div class="link-permissions">
                                <mat-icon>{{ link.permissionLevel === 'read' ? 'visibility' : 'edit' }}</mat-icon>
                                <span>{{ (link.permissionLevel === 'read' ? 'READ_ONLY' : 'READ_WRITE') | translate }}</span>
                            </div>
                            
                            <div class="link-expiry">
                                <mat-icon>schedule</mat-icon>
                                <span>{{ 'EXPIRES_AT' | translate }}: {{ link.expiresAt | date:'short' }}</span>
                            </div>
                        </div>
                        
                        <div class="link-actions">
                            <button mat-stroked-button (click)="copyShareUrl(link.shareUrl)" color="primary">
                                <mat-icon>content_copy</mat-icon>
                                {{ 'COPY_LINK' | translate }}
                            </button>
                        </div>
                    </mat-card>
                </div>
            </mat-card-content>
        </mat-card>
    </div>

    <!-- Third row: Sharing Users Section (full width) -->
    <div class="bento-row full-width">
        <!-- Sharing Users Section -->
        <mat-card class="sharing-users-section bento-item">
            <mat-card-header>
                <mat-icon mat-card-avatar>people</mat-icon>
                <mat-card-title>{{ 'SHARING_USERS' | translate }}</mat-card-title>
            </mat-card-header>
            <mat-card-content>
                <div class="sharing-container vertical-layout" *ngIf="!isLoadingSharingUsers">
                    <!-- Sharing With Users Section -->
                    <div class="sharing-block">
                        <h3>{{ 'SHARING_WITH_USERS' | translate }}</h3>
                        <div class="user-list">
                            <div *ngIf="sharingWithUsers.length === 0" class="no-users-message">
                                {{ 'NO_SHARING_WITH_USERS' | translate }}
                            </div>
                            <div *ngFor="let user of sharingWithUsers" class="user-item">
                                <div class="user-avatar" [ngStyle]="{'background-image': user.profilePicture ? 'url(' + user.profilePicture + ')' : 'none'}">
                                    <mat-icon *ngIf="!user.profilePicture">person</mat-icon>
                                </div>
                                <div class="user-info">
                                    <span class="user-name">{{ getUserDisplayName(user) }}</span>
                                    <div class="permission-container">
                                        <span class="permission-badge" [ngClass]="user.highestPermission">
                                            <mat-icon>{{ user.highestPermission === 'edit' ? 'edit' : 'visibility' }}</mat-icon>
                                            {{ (user.highestPermission === 'edit' ? 'READ_WRITE' : 'READ_ONLY') | translate }}
                                        </span>
                                        <span class="share-scope" *ngIf="user.shares && hasGlobalAccess(user)">
                                            {{ 'ALL_RECIPES' | translate }}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Divider between sections -->
                    <mat-divider></mat-divider>
                    
                    <!-- Sharing With Me Users Section -->
                    <div class="sharing-block">
                        <h3>{{ 'SHARING_WITH_ME_USERS' | translate }}</h3>
                        <div class="user-list">
                            <div *ngIf="sharingWithMeUsers.length === 0" class="no-users-message">
                                {{ 'NO_SHARING_WITH_ME_USERS' | translate }}
                            </div>
                            <div *ngFor="let user of sharingWithMeUsers" class="user-item">
                                <div class="user-avatar" [ngStyle]="{'background-image': user.profilePicture ? 'url(' + user.profilePicture + ')' : 'none'}">
                                    <mat-icon *ngIf="!user.profilePicture">person</mat-icon>
                                </div>
                                <div class="user-info">
                                    <span class="user-name">{{ getUserDisplayName(user) }}</span>
                                    <div class="permission-container">
                                        <span class="permission-badge" [ngClass]="user.highestPermission">
                                            <mat-icon>{{ user.highestPermission === 'edit' ? 'edit' : 'visibility' }}</mat-icon>
                                            {{ (user.highestPermission === 'edit' ? 'READ_WRITE' : 'READ_ONLY') | translate }}
                                        </span>
                                        <span class="share-scope" *ngIf="user.shares && hasGlobalAccess(user)">
                                            {{ 'ALL_RECIPES' | translate }}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div *ngIf="isLoadingSharingUsers" class="loading-container">
                    <mat-icon class="loading-icon">sync</mat-icon>
                    <span>{{ 'LOADING_SHARING_USERS' | translate }}</span>
                </div>
            </mat-card-content>
        </mat-card>
    </div>
</div>